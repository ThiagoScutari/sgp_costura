<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manual da Costureira</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @page { size: A4; margin: 0; }
    body { margin: 0; padding: 16mm; font-family: 'Inter', sans-serif; background: #f8fafc; }
    .page { page-break-after: always; }
    .page:last-child { page-break-after: auto; }
    .card { break-inside: avoid; }
  </style>
</head>
<body class="text-slate-900">
  <div class="text-center mb-6">
    <h1 class="text-2xl font-bold">Manual da Costureira</h1>
    <p class="text-sm text-slate-600">Planejamento: {{ planning.version_name }} | Código: {{ product_reference or 'N/A' }}</p>
  </div>

  {% for group in workstations|batch(4, fill_with=None) %}
    <div class="page grid grid-cols-2 gap-4">
      {% for ws in group %}
        {% if ws %}
          <div class="card bg-white border border-slate-200 rounded-xl shadow-sm p-4 flex flex-col gap-3">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-[10px] uppercase tracking-wide text-slate-500">Costureira</p>
                <p class="text-lg font-semibold text-slate-900">{{ ws.name }}</p>
              </div>
              <div class="text-right">
                <p class="text-[10px] uppercase text-slate-500">Modelo</p>
                <p class="text-sm font-medium text-slate-800">{{ product_description or '—' }}</p>
                <p class="text-[11px] text-slate-600">Código: {{ product_reference or '—' }}</p>
              </div>
            </div>

            <div class="overflow-hidden rounded-lg border border-slate-200">
              <table class="min-w-full text-xs">
                <thead class="bg-slate-50 text-slate-600">
                  <tr>
                    <th class="px-2 py-2 text-left w-10">Seq</th>
                    <th class="px-2 py-2 text-left">Descrição</th>
                    <th class="px-2 py-2 text-left w-20">Máquina</th>
                    <th class="px-2 py-2 text-center w-16">Tempo</th>
                    <th class="px-2 py-2 text-center w-12">Qtd</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-slate-200">
                  {% for op in ws.operations %}
                    <tr class="{% if op.is_fractioned %}bg-slate-100{% endif %}">
                      <td class="px-2 py-2 font-semibold text-slate-800">{{ op.sequence }}</td>
                      <td class="px-2 py-2 text-slate-700">{{ op.description }}</td>
                      <td class="px-2 py-2 text-slate-700">{{ op.machine }}</td>
                      <td class="px-2 py-2 text-center text-slate-700">{{ '%.2f'|format(op.time_min) }}m</td>
                      <td class="px-2 py-2 text-center font-semibold text-slate-800">{{ op.quantity }}{% if op.is_fractioned %} *F{% endif %}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <div class="flex items-center justify-between text-[11px] text-slate-600">
              <span>Total minutos: <strong class="text-slate-900">{{ '%.2f'|format(ws.total_minutes) }}</strong></span>
              <span>Qtd Operações: <strong class="text-slate-900">{{ ws.total_ops }}</strong></span>
            </div>
          </div>
        {% else %}
          <div class="card"></div>
        {% endif %}
      {% endfor %}
    </div>
  {% endfor %}

  <script>
    window.onload = () => { window.print(); };
  </script>
</body>
</html>